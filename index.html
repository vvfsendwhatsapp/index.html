<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Selezione VVF</title>

<link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css">
<script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  max-width: 720px;
  margin: 40px auto;
}
label {
  font-weight: bold;
  margin-top: 20px;
  display: block;
}
</style>
</head>

<body>

<h2>Invio dati</h2>

<label for="comando">Comando VVF</label>
<select id="comando" disabled></select>

<label for="prefisso">Prefisso internazionale</label>
<select id="prefisso" disabled></select>

<script>
// ================= CONFIG =================
const CSV_URL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vQ43tX6arNVgy_qw1nWFbCH_OHg-1Y7msl8pnhXzER67OaF2R5onlwHd_a5kMyPI2Uj12olSZnbXB3O/pub?gid=976441910&single=true&output=csv";

// ================= UTILS =================
const parseCSV = csv =>
  csv
    .trim()
    .split("\n")
    .map(r => r.split(",").map(c => c.trim()));

const buildSelect = (id, options, placeholder) => {
  const select = document.getElementById(id);
  const frag = document.createDocumentFragment();

  options.forEach(o => {
    const opt = document.createElement("option");
    opt.value = o.value;
    opt.textContent = o.label;
    frag.appendChild(opt);
  });

  select.appendChild(frag);
  select.disabled = false;

  return new Choices(select, {
    searchEnabled: true,
    shouldSort: true,
    itemSelectText: '',
    placeholderValue: placeholder
  });
};

// ================= LOAD =================
fetch(CSV_URL)
  .then(r => r.text())
  .then(csv => {
    const rows = parseCSV(csv).slice(1); // salta intestazione

    // ---- COMANDI (col A) ----
    const comandi = [...new Set(
      rows.map(r => r[0]).filter(Boolean)
    )].map(c => ({ value: c, label: c }));

    buildSelect("comando", comandi, "Seleziona comando");

    // ---- PREFISSI (col B + C) ----
    const prefissi = rows
      .filter(r => r[1] && r[2])
      .map(r => ({ label: r[1], value: r[2] }));

    buildSelect("prefisso", prefissi, "Seleziona prefisso");
  })
  .catch(err => console.error("Errore CSV:", err));
</script>

</body>
</html>
