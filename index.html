<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Selezione dinamica VVF</title>

<link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css">
<script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  max-width: 720px;
  margin: 40px auto;
}
label {
  font-weight: bold;
  margin-top: 20px;
  display: block;
}
</style>
</head>

<body>

<h2>Invio dati</h2>

<label for="comando">Comando VVF</label>
<select id="comando" disabled></select>

<label for="prefisso">Prefisso internazionale</label>
<select id="prefisso" disabled></select>

<script>
// ================= CONFIG =================
const URLS = {
  comandi:
    "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ43tX6arNVgy_qw1nWFbCH_OHg-1Y7msl8pnhXzER67OaF2R5onlwHd_a5kMyPI2Uj12olSZnbXB3O/pub?gid=1285745149&single=true&output=csv",
  prefissi:
    "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ43tX6arNVgy_qw1nWFbCH_OHg-1Y7msl8pnhXzER67OaF2R5onlwHd_a5kMyPI2Uj12olSZnbXB3O/pub?gid=363283712&single=true&output=csv"
};

// ================= UTILS =================
const parseCSV = csv =>
  csv
    .trim()
    .split("\n")
    .map(r => r.split(",").map(c => c.trim()));

const buildSelect = (selectId, options, placeholder) => {
  const select = document.getElementById(selectId);

  const fragment = document.createDocumentFragment();
  options.forEach(o => {
    const opt = document.createElement("option");
    opt.value = o.value;
    opt.textContent = o.label;
    fragment.appendChild(opt);
  });

  select.appendChild(fragment);
  select.disabled = false;

  return new Choices(select, {
    searchEnabled: true,
    shouldSort: true,
    itemSelectText: '',
    placeholderValue: placeholder
  });
};

// ================= LOAD DATA =================
Promise.all([
  fetch(URLS.comandi).then(r => r.text()),
  fetch(URLS.prefissi).then(r => r.text())
])
.then(([comandiCSV, prefissiCSV]) => {

  // ---- COMANDI: col A, da A15 ----
  const comandiRows = parseCSV(comandiCSV).slice(14);
  const comandi = comandiRows
    .filter(r => r[0])
    .map(r => ({ value: r[0], label: r[0] }));

  buildSelect("comando", comandi, "Seleziona comando");

  // ---- PREFISSI: col C value, col E label ----
  const prefissiRows = parseCSV(prefissiCSV).slice(1);
  const prefissi = prefissiRows
    .filter(r => r[2] && r[4])
    .map(r => ({ value: r[2], label: r[4] }));

  buildSelect("prefisso", prefissi, "Seleziona prefisso");

})
.catch(err => {
  console.error("Errore caricamento dati:", err);
});
</script>

</body>
</html>
